@using BlazorBlocks.BlockEditor
@using BlazorBlocks.Blocks.ImageBlock;
@using BlazorBlocks.Blocks.RawTextBlock;
@using BlazorBlocks.Blocks.TitleBlock;
@using BlazorBlocks.Model;

@page "/"

<PageTitle>Index</PageTitle>

<h1>Hello, world!</h1>

Welcome to your new app.
<hr />
<div class="content">
    <Editor Model="@editorModel" />

    <hr /><hr /><hr /><hr />
    <button @onclick="ReRender">ReRender</button> <br/>
    Render test zone:
    <div class="row p-5" style="border: 1px solid #000;">
        @((MarkupString)renderContent)
    </div>

    <hr /><hr /><hr /><hr />


    <div class="row">
        Serialization controls:
        <div class="p-5" style="border: 1px solid #000;">
            
            <button @onclick="() => Import()" class="btn btn-primary">Load</button>
            <button @onclick="() => Export()" class="btn btn-primary float-end">Export</button><br />
            <InputTextArea class="form-control" @bind-Value="@serialized" Rows="10" Cols="100" />
        </div>
    </div>
    
</div>
@code {
    EditorModel editorModel = new EditorModel();

    string renderContent;
    string serialized;

    protected override void OnInitialized()
    {
        base.OnInitialized();
        // Read in and save some default blocks for testing
        editorModel.Load($$$"""{"Rows":[{"ColumnCollectionName":null,"Columns":[{"ColumnSize":"col-md-12","Blocks":[{"$modelType":"TitleBlockModel","Title":"Title"}]}]},{"ColumnCollectionName":null,"Columns":[{"ColumnSize":"col-md-4","Blocks":[{"$modelType":"RawTextBlockModel","Content":"hello from index"}]},{"ColumnSize":"col-md-7","Blocks":[{"$modelType":"ImageBlockModel","ImageUrl":"","AltText":""}]}]}]}""");
        serialized = editorModel.Serialize();
        StateHasChanged();
    }

    protected void ReRender()
    {
        renderContent = editorModel.Render();
        StateHasChanged();
    }

    protected void Import()
    {
        editorModel.Load(serialized);
        StateHasChanged();
    }

    protected void Export()
    {
        serialized = editorModel.Serialize();
    }

}